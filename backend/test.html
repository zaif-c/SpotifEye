<!DOCTYPE html>
<html>
<head>
    <title>Spotify Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        #result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Spotify Auth Test</h1>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testMe()">Test /me</button>
    <button onclick="testLogout()">Test Logout</button>
    <div id="result"></div>

    <script>
        let currentToken = null;

        // Check for token or error in URL
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const error = urlParams.get('error');
            
            if (token) {
                currentToken = token;
                showResult('Successfully obtained access token!', 'success');
                // Clean up the URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (error) {
                showResult('Error: ' + error, 'error');
                // Clean up the URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        };

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = type;
        }

        async function testLogin() {
            try {
                const response = await fetch('http://127.0.0.1:8000/login');
                const data = await response.json();
                console.log('Authorization URL:', data.auth_url);
                window.location.href = data.auth_url;
            } catch (error) {
                showResult('Error: ' + error.message, 'error');
            }
        }

        async function testMe() {
            if (!currentToken) {
                showResult('Please login first', 'error');
                return;
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/me', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                const data = await response.json();
                showResult('User info: ' + JSON.stringify(data, null, 2), 'success');
            } catch (error) {
                showResult('Error: ' + error.message, 'error');
            }
        }

        async function testLogout() {
            if (!currentToken) {
                showResult('Please login first', 'error');
                return;
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                const data = await response.json();
                currentToken = null;
                showResult('Logout successful: ' + data.message, 'success');
            } catch (error) {
                showResult('Error: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html> 